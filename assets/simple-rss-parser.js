class SimpleRSSParser{constructor(){this.corsProxy="https://api.allorigins.win/raw?url=",this.debug=!0}log(...t){this.debug&&console.log("[Simple RSS Parser]",...t)}safeGetText(t,e){try{var r=t.querySelector(e);if(r)return r.textContent.trim();if(e.includes(":")){var a=e.split(":"),i=a[a.length-1],n=t.getElementsByTagName(e);if(0<n.length)return n[0].textContent.trim();var s,l=t.getElementsByTagName(i);if(0<l.length)return l[0].textContent.trim();for(s of t.querySelectorAll("*"))if(s.tagName===e||s.tagName===i||s.tagName.endsWith(":"+i)||s.localName===i)return s.textContent.trim()}return null}catch(t){return this.log(`Error getting text for ${e}:`,t.message),null}}extractSimpleArticle(r,a){try{this.log(`Processing item ${a+1}:`,r.tagName);var i=this.safeGetText(r,"title")||"Article "+(a+1);let t="#";try{var n,s=r.querySelector("link");"#"===(t=s?s.textContent.trim()||s.getAttribute("href")||"#":t)&&(n=r.querySelector("guid"))&&n.textContent.startsWith("http")&&(t=n.textContent.trim())}catch(t){this.log("Link extraction error:",t.message)}var l,o=this.safeGetText(r,"description")||this.safeGetText(r,"summary")||this.safeGetText(r,"content")||"暂无摘要";let e="Unknown Author";try{(e=this.safeGetText(r,"author")||this.safeGetText(r,"creator")||this.safeGetText(r,"managingEditor")||"Multiple Authors")&&"Multiple Authors"!==e||0<(l=r.getElementsByTagName("creator")).length&&(e=l[0].textContent.trim())}catch(t){this.log("Author extraction error:",t.message)}var c=this.safeGetText(r,"pubDate")||this.safeGetText(r,"published")||this.safeGetText(r,"updated")||(new Date).toISOString(),h={id:`simple_article_${Date.now()}_`+a,title:this.cleanText(i),abstract:this.cleanText(o),link:t,publishDate:this.parseDate(c),authors:this.cleanText(e),image:null,category:this.safeGetText(r,"category")||"General",journal:"Academic Journal"};return this.log("Successfully extracted: "+h.title),h}catch(t){return console.error(`Failed to extract article ${a+1}:`,t),{id:`error_article_${Date.now()}_`+a,title:"解析错误 - 文章 "+(a+1),abstract:"该文章在解析时发生错误，请稍后重试或直接访问原文。",link:"#",publishDate:(new Date).toISOString(),authors:"System",image:null,category:"Error",journal:"Error",isError:!0}}}cleanText(t){return t?t.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim().substring(0,500):""}parseDate(t){try{var e;return t?(e=new Date(t),(isNaN(e.getTime())?new Date:e).toISOString()):(new Date).toISOString()}catch(t){return(new Date).toISOString()}}async parseRSSSimple(r){try{this.log("Parsing RSS:",r);var t=await(await fetch(this.corsProxy+encodeURIComponent(r))).text();if(!t||t.length<100)throw new Error("Empty or invalid RSS response");var a=(new DOMParser).parseFromString(t,"text/xml"),i=a.querySelector("parsererror");if(i)throw new Error("XML parsing failed: "+i.textContent);let e=a.querySelectorAll("item");if(0===e.length&&(e=a.querySelectorAll("entry")),this.log(`Found ${e.length} items to process`),0===e.length)return[];var n=[];for(let t=0;t<Math.min(e.length,5);t++){var s=this.extractSimpleArticle(e[t],t);s&&n.push(s)}return this.log(`Successfully extracted ${n.length} articles`),n}catch(t){return console.error("RSS parsing failed:",t),[{id:"fallback_"+Date.now(),title:"RSS解析失败",abstract:"无法解析RSS源："+t.message,link:r,publishDate:(new Date).toISOString(),authors:"System",image:null,category:"Error",journal:"Error",isError:!0}]}}}window.simpleRSSParser=new SimpleRSSParser;