class ModernGallery{constructor(){this.currentZoom=1,this.maxZoom=5,this.minZoom=.1,this.currentImageSrc="",this.currentImageTitle="",this.currentImageDescription="",this.currentImageDate="",this.currentImageLocation="",this.currentImageCamera="",this.currentImageTags=[],this.isLightboxOpen=!1,this.isOriginalViewerOpen=!1,this.visibleItems=12,this.totalItems=0,this.currentImageIndex=0,this.allImages=[],this.currentTab="details",this.init()}init(){this.setupEventListeners(),this.setupLazyLoading(),this.setupFilterSystem(),this.setupLoadMore(),this.addScrollAnimations(),this.initializeImageData(),this.setupTabSystem()}initializeImageData(){var e=document.querySelectorAll(".gallery-item");this.allImages=Array.from(e).map((e,t)=>{var a=e.querySelector(".photo-image"),n=e.querySelector(".photo-title").textContent,i=e.querySelector(".photo-description").textContent,r=e.querySelectorAll(".meta-item");let o="",l="",s="";r.forEach(e=>{e=e.textContent.trim();e.includes("ğŸ“…")&&(o=e.replace("ğŸ“…","").trim()),e.includes("ğŸ“")&&(l=e.replace("ğŸ“","").trim()),e.includes("ğŸ“·")&&(s=e.replace("ğŸ“·","").trim())});r=Array.from(e.querySelectorAll(".tag")).map(e=>e.textContent);return{index:t,src:a.src,title:n,description:i,date:o,location:l,camera:s,tags:r,element:e}})}setupTabSystem(){document.addEventListener("click",e=>{e.target.matches(".tab-btn")&&(e=e.target.dataset.tab,this.switchTab(e))})}switchTab(e){document.querySelectorAll(".tab-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.querySelectorAll(".tab-panel").forEach(e=>{e.classList.remove("active")}),document.getElementById(e+"-panel").classList.add("active"),"exif"===(this.currentTab=e)?this.loadExifData():"metadata"===e&&this.loadMetadata()}setupEventListeners(){document.addEventListener("click",e=>{var t;(e.target.matches(".filter-btn")||e.target.closest(".filter-btn"))&&(t=(e=e.target.closest(".filter-btn")).dataset.category,this.filterGallery(t),this.updateActiveFilter(e))}),document.addEventListener("click",e=>{var t;(e.target.matches(".tag")||e.target.closest(".tag"))&&(t=(e=e.target.closest(".tag")).textContent.trim(),this.filterByTag(t),this.highlightActiveTag(e))}),document.addEventListener("keydown",e=>{if(this.isLightboxOpen)switch(e.key){case"Escape":this.closeLightbox();break;case"ArrowLeft":this.navigateImage(-1);break;case"ArrowRight":this.navigateImage(1);break;case"f":case"F":this.toggleFullscreen()}this.isOriginalViewerOpen&&"Escape"===e.key&&this.closeOriginalViewer()})}filterByTag(t){console.log("Filtering by tag:",t);var e=document.querySelectorAll(".gallery-item");let a=0;e.forEach(e=>{Array.from(e.querySelectorAll(".tag")).map(e=>e.textContent.trim()).includes(t)?(e.style.display="block",e.style.animation="fadeInUp 0.5s ease",a++):e.style.display="none"}),this.updateResultCount(a,"æ ‡ç­¾: "+t),document.querySelectorAll(".filter-btn").forEach(e=>{e.classList.remove("active")}),this.showTagFilterIndicator(t)}showTagFilterIndicator(e){var t=document.querySelector(".tag-filter-indicator"),t=(t&&t.remove(),document.createElement("div"));t.className="tag-filter-indicator",t.innerHTML=`
      <span class="indicator-text">
        <i class="fas fa-tag"></i>
        æ­£åœ¨æ˜¾ç¤ºæ ‡ç­¾: <strong>${e}</strong>
      </span>
      <button class="clear-filter-btn" onclick="window.modernGallery.clearAllFilters()">
        <i class="fas fa-times"></i>
        æ¸…é™¤è¿‡æ»¤
      </button>
    `,document.querySelector(".filter-section .container").appendChild(t)}clearAllFilters(){var e=document.querySelectorAll(".gallery-item"),t=(e.forEach(e=>{e.style.display="block",e.style.animation="fadeInUp 0.5s ease"}),document.querySelectorAll(".filter-btn").forEach(e=>{e.classList.remove("active")}),document.querySelector('.filter-btn[data-category="all"]').classList.add("active"),document.querySelector(".tag-filter-indicator"));t&&t.remove(),document.querySelectorAll(".tag.active").forEach(e=>{e.classList.remove("active")}),this.updateResultCount(e.length,"å…¨éƒ¨")}highlightActiveTag(e){document.querySelectorAll(".tag.active").forEach(e=>{e.classList.remove("active")});let t=e.textContent.trim();document.querySelectorAll(".tag").forEach(e=>{e.textContent.trim()===t&&e.classList.add("active")})}updateResultCount(e,t){let a=document.querySelector(".result-info");a||((a=document.createElement("div")).className="result-info",document.querySelector(".filter-section .container").appendChild(a)),a.innerHTML=`
      <i class="fas fa-images"></i>
      æ˜¾ç¤º <strong>${e}</strong> å¼ å›¾ç‰‡ (${t})
    `}setupLazyLoading(){if("IntersectionObserver"in window){let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&((e=e.target).classList.add("loaded"),t.unobserve(e))})});document.querySelectorAll(".photo-image").forEach(e=>{t.observe(e)})}}setupFilterSystem(){let a=document.querySelectorAll(".filter-btn"),n=document.querySelectorAll(".gallery-item");a.forEach(t=>{t.addEventListener("click",()=>{a.forEach(e=>e.classList.remove("active")),t.classList.add("active");var e=t.dataset.category;this.filterItems(e,n)})})}filterItems(a,e){e.forEach((e,t)=>{"all"===a||e.dataset.category===a?(e.style.display="block",setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},50*t)):(e.style.opacity="0",e.style.transform="translateY(30px)",setTimeout(()=>{e.style.display="none"},300))}),this.updateVisibleCount()}setupLoadMore(){var e=document.getElementById("loadMoreBtn"),t=document.querySelectorAll(".gallery-item");this.totalItems=t.length,this.showItems(this.visibleItems),e&&this.totalItems>this.visibleItems&&(e.style.display="block",e.addEventListener("click",()=>{this.loadMoreItems()}))}showItems(a){document.querySelectorAll(".gallery-item").forEach((e,t)=>{e.style.display=t<a?"block":"none"})}loadMoreItems(){var e=document.getElementById("loadMoreBtn");this.visibleItems+=8,this.showItems(this.visibleItems),this.visibleItems>=this.totalItems&&(e.style.display="none"),this.addScrollAnimations()}addScrollAnimations(){if("IntersectionObserver"in window){let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)")})},{threshold:.1,rootMargin:"50px"});document.querySelectorAll(".gallery-item").forEach(e=>{t.observe(e)})}}openAdvancedLightbox(t,e,a,n,i,r,o){var l=document.getElementById("lightbox"),s=document.getElementById("lightboxImage"),c=document.getElementById("imageLoader");this.currentImageSrc=t,this.currentImageTitle=e,this.currentImageDescription=a,this.currentImageDate=n,this.currentImageLocation=i,this.currentImageCamera=r,this.currentImageTags="string"==typeof o?o.split(","):o||[],this.isLightboxOpen=!0,this.currentImageIndex=this.allImages.findIndex(e=>e.src===t),c.style.display="flex",s.style.opacity="0",document.getElementById("lightboxTitleHeader").textContent=e,document.getElementById("lightboxDateHeader").textContent=n?new Date(n).toLocaleDateString("zh-CN"):"",document.getElementById("lightboxLocationHeader").textContent=i||"",this.updateLightboxInfo(),l.classList.add("active"),document.body.style.overflow="hidden",this.loadLightboxImage(t,e),this.resetZoom(),this.updateNavigationButtons()}loadLightboxImage(e,t){let a=document.getElementById("lightboxImage"),n=document.getElementById("imageLoader"),i=new Image;i.onload=()=>{a.src=e,a.alt=t,setTimeout(()=>{n.style.display="none",a.style.opacity="1"},300),this.updateImageDimensions(i.naturalWidth,i.naturalHeight)},i.onerror=()=>{n.innerHTML='<div class="error-message">å›¾ç‰‡åŠ è½½å¤±è´¥</div>'},i.src=e}updateLightboxInfo(){document.getElementById("lightboxTitle").textContent=this.currentImageTitle,document.getElementById("lightboxDescription").textContent=this.currentImageDescription,document.getElementById("lightboxDate").textContent=this.formatDate(this.currentImageDate),document.getElementById("lightboxLocation").textContent=this.currentImageLocation||"æœªçŸ¥",document.getElementById("lightboxCamera").textContent=this.currentImageCamera||"æœªçŸ¥";let a=document.getElementById("lightboxTags");a.innerHTML="",this.currentImageTags.forEach(e=>{var t;e.trim()&&((t=document.createElement("span")).className="tag",t.textContent=e.trim(),a.appendChild(t))}),document.getElementById("imageUrl").value=window.location.origin+this.currentImageSrc}formatDate(e){if(!e)return"æœªçŸ¥";try{return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})}catch{return e}}navigateImage(e){this.isLightboxOpen&&0!==this.allImages.length&&(this.currentImageIndex+=e,this.currentImageIndex<0?this.currentImageIndex=this.allImages.length-1:this.currentImageIndex>=this.allImages.length&&(this.currentImageIndex=0),e=this.allImages[this.currentImageIndex],this.openAdvancedLightbox(e.src,e.title,e.description,e.date,e.location,e.camera,e.tags))}updateNavigationButtons(){var e=document.querySelector(".prev-btn"),t=document.querySelector(".next-btn");e&&t&&(e.disabled=this.allImages.length<=1,t.disabled=this.allImages.length<=1)}viewOriginalImage(e,t){var a=document.getElementById("originalViewer");let n=document.getElementById("originalImage"),i=document.getElementById("originalLoader"),r=document.getElementById("originalResolution"),o=(this.isOriginalViewerOpen=!0,a.classList.add("active"),i.style.display="flex",n.style.opacity="0",document.getElementById("loadingProgress").style.width="0%",0),l=setInterval(()=>{90<(o+=15*Math.random())&&(o=90),document.getElementById("loadingProgress").style.width=o+"%"},200),s=new Image;s.onload=()=>{clearInterval(l),document.getElementById("loadingProgress").style.width="100%",n.src=e,n.alt=t,r.textContent=`${s.naturalWidth} Ã— ${s.naturalHeight} åƒç´ `,setTimeout(()=>{i.style.display="none",n.style.opacity="1"},500),this.setupOriginalImageInteraction(n)},s.onerror=()=>{clearInterval(l),i.innerHTML='<div class="error-message">åŸå›¾åŠ è½½å¤±è´¥</div>'},s.src=e}viewOriginalFromLightbox(){this.viewOriginalImage(this.currentImageSrc,this.currentImageTitle)}closeOriginalViewer(){document.getElementById("originalViewer").classList.remove("active"),this.isOriginalViewerOpen=!1}setupOriginalImageInteraction(t){let a=1,n=0,i=0,r=!1,o,l;t.addEventListener("wheel",e=>{e.preventDefault();e=0<e.deltaY?.9:1.1;a*=e,a=Math.max(.1,Math.min(10,a)),this.updateOriginalImageTransform(t,a,n,i)}),t.addEventListener("mousedown",e=>{r=!0,o=e.clientX-n,l=e.clientY-i,t.style.cursor="grabbing"}),document.addEventListener("mousemove",e=>{r&&(n=e.clientX-o,i=e.clientY-l,this.updateOriginalImageTransform(t,a,n,i))}),document.addEventListener("mouseup",()=>{r=!1,t.style.cursor="grab"}),t.addEventListener("dblclick",()=>{a=1,n=0,i=0,this.updateOriginalImageTransform(t,a,n,i)})}updateOriginalImageTransform(e,t,a,n){e.style.transform=`scale(${t}) translate(${a}px, ${n}px)`}toggleFullscreen(){var e=document.querySelector(".lightbox-container");document.fullscreenElement?document.exitFullscreen():e.requestFullscreen().catch(e=>{console.log("Error attempting to enable fullscreen:",e.message)})}loadExifData(){let i=document.getElementById("exifData");i.innerHTML='<div class="exif-loading"><div class="loader-spinner small"></div><span>è¯»å–EXIFä¿¡æ¯ä¸­...</span></div>',setTimeout(()=>{var e,t,a={"ç›¸æœºåˆ¶é€ å•†":this.currentImageCamera||"Unknown","æ‹æ‘„æ—¶é—´":this.currentImageDate||"Unknown","æ›å…‰æ—¶é—´":"1/60s","å…‰åœˆå€¼":"f/2.8","ISOæ„Ÿå…‰åº¦":"400","ç„¦è·":"24mm","é—ªå…‰ç¯":"æœªä½¿ç”¨","ç™½å¹³è¡¡":"è‡ªåŠ¨","è‰²å½©ç©ºé—´":"sRGB"};let n='<div class="exif-data">';for([e,t]of Object.entries(a))n+=`
          <div class="exif-item">
            <span class="exif-key">${e}</span>
            <span class="exif-value">${t}</span>
          </div>
        `;n+="</div>",i.innerHTML=n},1e3)}loadMetadata(){this.getImageFileSize(this.currentImageSrc)}async getImageFileSize(e){try{var t,a=(await fetch(e,{method:"HEAD"})).headers.get("content-length");a?(t=(parseInt(a)/1048576).toFixed(2),document.getElementById("fileSize").textContent=t+" MB"):document.getElementById("fileSize").textContent="æ— æ³•è·å–"}catch(e){document.getElementById("fileSize").textContent="æ— æ³•è·å–"}}updateImageDimensions(e,t){document.getElementById("imageDimensions").textContent=e+` Ã— ${t} åƒç´ `}toggleExifInfo(){"exif"!==this.currentTab&&this.switchTab("exif")}closeLightbox(){document.getElementById("lightbox").classList.remove("active"),document.body.style.overflow="",this.isLightboxOpen=!1,this.resetZoom()}zoomImage(e){this.currentZoom*=e,this.currentZoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.currentZoom));e=document.getElementById("lightboxImage");e.style.transform=`scale(${this.currentZoom})`,document.getElementById("zoomLevel").textContent=Math.round(100*this.currentZoom)+"%",1<this.currentZoom?(e.style.cursor="grab",this.enableImageDragging(e)):(e.style.cursor="default",this.disableImageDragging(e))}resetZoom(){this.currentZoom=1;var e=document.getElementById("lightboxImage");e.style.transform="scale(1)",e.style.cursor="default",document.getElementById("zoomLevel")&&(document.getElementById("zoomLevel").textContent="100%"),this.disableImageDragging(e)}enableImageDragging(t){let a=!1,n,i,r=0,o=0;var e=e=>{a=!0,t.style.cursor="grabbing",n=e.clientX-r,i=e.clientY-o},l=e=>{a&&(e.preventDefault(),r=e.clientX-n,o=e.clientY-i,t.style.transform=`scale(${this.currentZoom}) translate(${r}px, ${o}px)`)},s=()=>{a=!1,t.style.cursor="grab"};t.addEventListener("mousedown",e),document.addEventListener("mousemove",l),document.addEventListener("mouseup",s),t._dragHandlers={handleMouseDown:e,handleMouseMove:l,handleMouseUp:s}}disableImageDragging(e){e._dragHandlers&&(e.removeEventListener("mousedown",e._dragHandlers.handleMouseDown),document.removeEventListener("mousemove",e._dragHandlers.handleMouseMove),document.removeEventListener("mouseup",e._dragHandlers.handleMouseUp),delete e._dragHandlers)}downloadImage(){var e;this.currentImageSrc&&((e=document.createElement("a")).href=this.currentImageSrc,e.download=this.currentImageTitle||"image",document.body.appendChild(e),e.click(),document.body.removeChild(e))}shareCurrentImage(){this.sharePhoto(this.currentImageTitle,window.location.origin+this.currentImageSrc)}sharePhoto(e,t){navigator.share?navigator.share({title:e,text:"æŸ¥çœ‹è¿™å¼ ç²¾å½©çš„ç…§ç‰‡ï¼š"+e,url:t}).catch(console.error):(e=e+" - "+t,navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{this.showNotification("é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼")}):((t=document.createElement("textarea")).value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.showNotification("é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼")))}showNotification(e){let t=document.createElement("div");t.className="notification",t.textContent=e,t.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4CAF50;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      z-index: 10000;
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease;
    `,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},100),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(-20px)",setTimeout(()=>{document.body.removeChild(t)},300)},3e3)}handleScroll(){let a=window.pageYOffset;document.querySelectorAll(".bg-shape").forEach((e,t)=>{t=.5+.2*t;e.style.transform=`translateY(${a*t}px)`})}updateVisibleCount(){var e=document.querySelectorAll('.gallery-item[style*="block"], .gallery-item:not([style*="none"])');console.log(`æ˜¾ç¤º ${e.length} å¼ ç…§ç‰‡`)}filterGallery(a){console.log("Filtering gallery by category:",a);var e=document.querySelectorAll(".gallery-item");let n=0;e.forEach(e=>{var t=e.dataset.category;"all"===a||t===a?(e.style.display="block",e.style.animation="fadeInUp 0.5s ease",n++):e.style.display="none"});this.updateResultCount(n,"all"===a?"å…¨éƒ¨":a);e=document.querySelector(".tag-filter-indicator");e&&e.remove(),document.querySelectorAll(".tag.active").forEach(e=>{e.classList.remove("active")})}updateActiveFilter(e){document.querySelectorAll(".filter-btn").forEach(e=>{e.classList.remove("active")}),e.classList.add("active")}}function openLightbox(e,t,a){window.modernGallery&&window.modernGallery.openAdvancedLightbox(e,t,a,"","","",[])}function openAdvancedLightbox(e,t,a,n,i,r,o){window.modernGallery&&window.modernGallery.openAdvancedLightbox(e,t,a,n,i,r,o)}function viewOriginalImage(e,t){window.modernGallery&&window.modernGallery.viewOriginalImage(e,t)}function viewOriginalFromLightbox(){window.modernGallery&&window.modernGallery.viewOriginalFromLightbox()}function closeOriginalViewer(){window.modernGallery&&window.modernGallery.closeOriginalViewer()}function navigateImage(e){window.modernGallery&&window.modernGallery.navigateImage(e)}function toggleFullscreen(){window.modernGallery&&window.modernGallery.toggleFullscreen()}function toggleExifInfo(){window.modernGallery&&window.modernGallery.toggleExifInfo()}function downloadOriginalImage(){var e;window.modernGallery&&((e=document.createElement("a")).href=window.modernGallery.currentImageSrc,e.download=window.modernGallery.currentImageTitle+"_original"||"original_image",document.body.appendChild(e),e.click(),document.body.removeChild(e))}function closeLightbox(){window.modernGallery&&window.modernGallery.closeLightbox()}function zoomImage(e){window.modernGallery&&window.modernGallery.zoomImage(e)}function resetZoom(){window.modernGallery&&window.modernGallery.resetZoom()}function downloadImage(){window.modernGallery&&window.modernGallery.downloadImage()}function shareCurrentImage(){window.modernGallery&&window.modernGallery.shareCurrentImage()}function sharePhoto(e,t){window.modernGallery&&window.modernGallery.sharePhoto(e,t)}function clearAllFilters(){window.modernGallery&&window.modernGallery.clearAllFilters()}function filterByTag(e){window.modernGallery&&window.modernGallery.filterByTag(e)}if(document.addEventListener("DOMContentLoaded",()=>{window.modernGallery=new ModernGallery,document.body.style.opacity="0",setTimeout(()=>{document.body.style.transition="opacity 0.5s ease",document.body.style.opacity="1"},100)}),document.addEventListener("visibilitychange",()=>{var e=document.querySelectorAll('[style*="animation"]');document.hidden?e.forEach(e=>{e.style.animationPlayState="paused"}):e.forEach(e=>{e.style.animationPlayState="running"})}),"PerformanceObserver"in window){let e=new PerformanceObserver(e=>{for(var t of e.getEntries())"largest-contentful-paint"===t.entryType&&console.log("LCP:",t.startTime)});e.observe({entryTypes:["largest-contentful-paint"]})}