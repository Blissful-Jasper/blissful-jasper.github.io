class JournalsRSSHandler{constructor(){this.corsProxy="https://api.rss2json.com/v1/api.json?rss_url=",this.cache=new Map,this.cacheExpiry=36e5}async fetchRSSFeed(e){var t=e,a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.cacheExpiry)return a.data;try{var r=await(await fetch(this.corsProxy+encodeURIComponent(e))).json();return"ok"===r.status?(this.cache.set(t,{data:r.items,timestamp:Date.now()}),r.items):(console.error("RSS fetch error:",r.message),[])}catch(e){return console.error("Failed to fetch RSS:",e),[]}}filterGeoscienceContent(e){if(!journalsConfig.display.geoscience_filter)return e;let a=["climate","atmospheric","ocean","earth","geophysics","geology","meteorology","hydrology","glaciology","seismology","volcanology","paleoclimate","carbon","greenhouse","temperature","precipitation","sea level","ice","weather","storm","hurricane","typhoon","ENSO","El Niño","La Niña","monsoon","drought","flood","气候","大气","海洋","地球","地质","气象","水文","冰川","地震","火山","古气候","碳","温室","温度","降水","海平面","冰","天气","风暴","飓风","台风","厄尔尼诺","拉尼娜","季风"];return e.filter(e=>{let t=(e.title+" "+e.description).toLowerCase();return a.some(e=>t.includes(e.toLowerCase()))})}createArticleCard(e,t,a){var r=document.createElement("div"),i=(r.className="article-card",r.style.borderLeftColor=a,e.link&&e.link.startsWith("http")?e.link:"#"),s=this.escapeHtml(e.title||"Untitled"),n=this.escapeHtml(e.description||"No description available"),l=this.escapeHtml(e.author||"Unknown Author");return r.innerHTML=`
      <h3 class="article-title">${s}</h3>
      <div class="article-meta">
        <div class="article-authors">${l}</div>
        <div class="article-date">${new Date(e.pubDate).toLocaleDateString("zh-CN")}</div>
      </div>
      <div class="article-abstract">${this.truncateText(n,200)}</div>
      <div class="article-actions">
        <button class="read-full-btn primary-btn" onclick="window.open('${i}', '_blank')" ${"#"===i?"disabled":""}>
          <i class="fas fa-external-link-alt"></i>
          阅读原文
        </button>
      </div>
      <div class="article-tags">
        <span class="article-tag" style="background-color: ${a}20; color: ${a};">${t}</span>
      </div>
    `,r}escapeHtml(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}truncateText(e,t){return e?e.length>t?e.substring(0,t)+"...":e:""}async loadJournalArticles(a){var r=document.getElementById("articles-"+a.name.toLowerCase().replace(/\s+/g,"-"));if(r)try{var e=await this.fetchRSSFeed(a.rss_url),i=this.filterGeoscienceContent(e).slice(0,journalsConfig.display.articles_per_journal);if(r.innerHTML="",0===i.length)r.innerHTML='<div class="no-articles">暂无相关地球科学文献</div>';else{let t=document.createElement("div");t.className="articles-grid",i.forEach(e=>{e=this.createArticleCard(e,a.name,a.color);t.appendChild(e)}),r.appendChild(t)}}catch(e){console.error(`Failed to load articles for ${a.name}:`,e),r.innerHTML='<div class="error-message">加载文章失败，请稍后重试</div>'}}}let rssHandler=new JournalsRSSHandler;async function initializeRSSFeeds(){var e;for(e of journalsConfig.journals)await rssHandler.loadJournalArticles(e),await new Promise(e=>setTimeout(e,1e3));updateLastUpdateTime()}async function refreshFeeds(){var e=document.querySelector(".refresh-btn"),t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i> 刷新中...',e.disabled=!0,rssHandler.cache.clear(),await initializeRSSFeeds(),e.innerHTML=t,e.disabled=!1}function setupFilterButtons(){let a=document.querySelectorAll(".filter-btn"),r=document.querySelectorAll(".journal-section");a.forEach(e=>{e.addEventListener("click",()=>{a.forEach(e=>e.classList.remove("active")),e.classList.add("active");let t=e.dataset.category;r.forEach(e=>{"all"===t||e.dataset.category===t?e.classList.remove("hidden"):e.classList.add("hidden")})})})}function updateLastUpdateTime(){var e=document.getElementById("last-update");e&&(e.textContent=(new Date).toLocaleString("zh-CN"))}function debounce(t,a){let r;return function(...e){clearTimeout(r),r=setTimeout(()=>{clearTimeout(r),t(...e)},a)}}window.journalsRSSHandler=rssHandler,window.initializeRSSFeeds=initializeRSSFeeds,window.refreshFeeds=refreshFeeds,window.setupFilterButtons=setupFilterButtons;