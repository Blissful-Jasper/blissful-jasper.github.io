class SiteSearch{constructor(){this.searchData=[],this.searchInput=document.getElementById("search-input"),this.clearButton=document.getElementById("clear-search"),this.searchFilters=document.getElementById("search-filters"),this.searchResults=document.getElementById("search-results"),this.resultsCount=document.querySelector(".results-count"),this.resultsList=document.querySelector(".results-list"),this.init()}async init(){await this.loadSearchData(),this.bindEvents()}async loadSearchData(){try{var t=await(await fetch("/blog/index.json")).json(),e=[{title:"气候变化与极端天气事件",type:"research",url:"/research.html#climate-change",excerpt:"研究气候变化对极端天气事件频率和强度的影响，包括热浪、暴雨、干旱等极端事件的变化趋势。",tags:["气候变化","极端天气","数据分析"],date:"2024-01-01"},{title:"海洋动力学建模",type:"research",url:"/research.html#ocean-dynamics",excerpt:"利用数值模型研究海洋环流、波浪传播和海洋-大气相互作用机制。",tags:["海洋学","数值建模","动力学"],date:"2024-01-01"},{title:"Climate Model Evaluation Using CMIP6 Data",type:"publications",url:"/publications.html#cmip6-eval",excerpt:"Comprehensive evaluation of climate models using the latest CMIP6 dataset to assess model performance in simulating historical climate patterns.",tags:["CMIP6","Climate Models","Model Evaluation"],date:"2024-06-15"}];this.searchData=[...t,...e]}catch(t){console.error("Failed to load search data:",t),this.searchData=[]}}bindEvents(){this.searchInput.addEventListener("input",t=>{t=t.target.value.trim();0<t.length?(this.clearButton.style.display="block",this.searchFilters.style.display="block",this.performSearch(t)):this.clearSearch()}),this.clearButton.addEventListener("click",()=>{this.clearSearch()}),document.querySelectorAll(".filter-option input").forEach(t=>{t.addEventListener("change",()=>{var t=this.searchInput.value.trim();t&&this.performSearch(t)})}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.clearSearch()})}clearSearch(){this.searchInput.value="",this.clearButton.style.display="none",this.searchFilters.style.display="none",this.searchResults.style.display="none"}performSearch(e){let s=Array.from(document.querySelectorAll(".filter-option input:checked")).map(t=>t.value);var t=this.searchData.filter(t=>!!s.includes(t.type)&&(t.title+` ${t.excerpt} `+(t.tags?.join(" ")||"")).toLowerCase().includes(e.toLowerCase()));this.displayResults(t,e)}displayResults(t,e){this.searchResults.style.display="block",this.resultsCount.textContent=`找到 ${t.length} 个结果`,this.resultsList.innerHTML=0===t.length?`
        <div class="no-results">
          <i class="fas fa-search" style="font-size: 2rem; color: var(--text-muted); margin-bottom: var(--spacing-sm);"></i>
          <p>没有找到相关内容</p>
          <p style="font-size: 0.9rem; color: var(--text-muted);">试试其他关键词或调整筛选条件</p>
        </div>
      `:t.map(t=>this.renderResultItem(t,e)).join("")}renderResultItem(t,e){var s=this.highlightText(t.title,e),e=this.highlightText(t.excerpt,e),a=t.tags?t.tags.map(t=>`<a href="#" class="result-tag" onclick="searchTags('${t}')">${t}</a>`).join(""):"";return`
      <div class="result-item">
        <div class="result-title">
          <a href="${t.url}">${s}</a>
        </div>
        <div class="result-meta">
          <span class="result-type">${{blog:"博客",research:"研究",publications:"论文"}[t.type]||t.type}</span>
          ${t.date?`• <span class="result-date">${this.formatDate(t.date)}</span>`:""}
        </div>
        <div class="result-excerpt">${e}</div>
        ${a?`<div class="result-tags">${a}</div>`:""}
      </div>
    `}highlightText(t,e){return e?(e=new RegExp(`(${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"),t.replace(e,"<mark>$1</mark>")):t}formatDate(t){return new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}}function searchTags(t){var e=document.getElementById("search-input");e&&(e.value=t,e.dispatchEvent(new Event("input")),e.scrollIntoView({behavior:"smooth"}))}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("search-input")&&new SiteSearch});class BlogTagFilter{constructor(){this.currentTag=null,this.allPosts=[],this.init()}init(){this.allPosts=Array.from(document.querySelectorAll(".blog-post-card")),this.bindTagEvents(),this.createTagCloud()}bindTagEvents(){document.addEventListener("click",t=>{(t.target.classList.contains("tag")||t.target.classList.contains("blog-tag"))&&(t.preventDefault(),t=t.target.textContent.trim(),this.filterByTag(t))})}filterByTag(t){this.currentTag===t?(this.currentTag=null,this.showAllPosts(),this.updateTagStates()):(this.currentTag=t,this.showPostsWithTag(t),this.updateTagStates(t),this.showFilterStatus(t))}showPostsWithTag(e){this.allPosts.forEach(t=>{Array.from(t.querySelectorAll(".tag, .blog-tag")).map(t=>t.textContent.trim()).includes(e)?(t.style.display="block",t.classList.add("tag-filtered")):(t.style.display="none",t.classList.remove("tag-filtered"))})}showAllPosts(){this.allPosts.forEach(t=>{t.style.display="block",t.classList.remove("tag-filtered")}),this.hideFilterStatus()}updateTagStates(e=null){document.querySelectorAll(".tag, .blog-tag").forEach(t=>{e&&t.textContent.trim()===e?t.classList.add("tag-active"):t.classList.remove("tag-active")})}createTagCloud(){var t=document.querySelector(".tag-cloud");if(t){let e={};document.querySelectorAll(".tag, .blog-tag").forEach(t=>{t=t.textContent.trim();e[t]=(e[t]||0)+1});var s=Object.entries(e).sort(([,t],[,e])=>e-t).slice(0,20);t.innerHTML=s.map(([t,e])=>`<span class="tag-cloud-item" onclick="blogTagFilter.filterByTag('${t}')">${t} <small>(${e})</small></span>`).join("")}}showFilterStatus(t){let e=document.querySelector(".filter-status");!e&&((e=document.createElement("div")).className="filter-status",s=document.querySelector(".blog-posts, .posts-container"))&&s.insertBefore(e,s.firstChild);var s=this.allPosts.filter(t=>"none"!==t.style.display).length;e.innerHTML=`
      <div class="filter-info">
        <i class="fas fa-filter"></i>
        正在显示标签 "<strong>${t}</strong>" 的 ${s} 篇文章
        <button onclick="blogTagFilter.showAllPosts()" class="clear-filter-btn">
          <i class="fas fa-times"></i> 清除过滤
        </button>
      </div>
    `}hideFilterStatus(){var t=document.querySelector(".filter-status");t&&t.remove()}}let blogTagFilter;document.addEventListener("DOMContentLoaded",()=>{blogTagFilter=new BlogTagFilter});