---
layout: page
title: Blog
permalink: /blog.html
---

<!-- 阅读进度条样式 -->
<link rel="stylesheet" href="{{ '/assets/reading-progress.css' | relative_url }}">

{% unless site.page_sections.blog %}
<link rel="stylesheet" href="assets/page-disabled-styles.css">
<div class="page-disabled-notice">
  <div class="notice-content">
    <h2>页面暂时关闭</h2>
    <p>Blog 页面当前已在配置中禁用。</p>
    <p>如需启用此页面，请在 _config.yml 中设置 blog: true</p>
    <a href="/" class="back-home-btn">返回主页</a>
  </div>
</div>
{% else %}

<link rel="stylesheet" href="assets/blog-page-style.css">

<!-- Hero Section -->
<div class="blog-hero">
  <div class="hero-content">
    <h1 class="hero-title">
      <i class="fas fa-feather-alt"></i>
      博客文章
    </h1>
    <p class="hero-subtitle">分享技术见解，记录学习思考</p>
    <div class="hero-stats">
      <div class="stat-item">
        <span class="stat-number" id="totalPosts">{{ site.posts.size | plus: site.data.blog.size }}</span>
        <span class="stat-label">篇文章</span>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <span class="stat-number" id="totalCategories">--</span>
        <span class="stat-label">个分类</span>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <span class="stat-number" id="totalTags">--</span>
        <span class="stat-label">个标签</span>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="content-wrapper blog-page">
  <!-- Search and Filter Section -->
  <section class="blog-search-section">
    <div class="search-header">
      <h2 class="search-title">
        <i class="fas fa-search"></i>
        发现内容
      </h2>
      <p class="search-description">搜索您感兴趣的文章和话题</p>
    </div>
    
    <div class="search-controls">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-input" placeholder="搜索文章标题、内容或标签..." id="blogSearch">
        <button class="search-clear" id="searchClear" style="display: none;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="filter-controls">
        <select class="filter-select" id="categoryFilter">
          <option value="">所有分类</option>
        </select>
        <select class="filter-select" id="sortFilter">
          <option value="date-desc">最新发布</option>
          <option value="date-asc">最早发布</option>
          <option value="title-asc">标题 A-Z</option>
          <option value="title-desc">标题 Z-A</option>
        </select>
      </div>
    </div>
    
    <!-- Tag Cloud -->
    <div class="tag-cloud-section">
      <h3 class="tag-cloud-title">
        <i class="fas fa-tags"></i>
        热门标签
      </h3>
      <div class="tag-cloud" id="tagCloud">
        <!-- Tags will be generated by JavaScript -->
      </div>
    </div>
  </section>
  
  <!-- Results Info -->
  <div class="results-info" id="resultsInfo">
    <span class="results-count">显示 <strong id="visibleCount">{{ site.data.blog.size }}</strong> 篇文章</span>
    <div class="view-toggle">
      <button class="view-btn active" data-view="grid" title="网格视图">
        <i class="fas fa-th"></i>
      </button>
      <button class="view-btn" data-view="list" title="列表视图">
        <i class="fas fa-list"></i>
      </button>
    </div>
  </div>
  
  <!-- Blog Posts Section -->
  <section class="blog-section">
    <div class="blog-grid" id="blogGrid">
      <!-- Standard Jekyll Posts from _posts directory -->
      {% for post in site.posts %}
      <article class="blog-post-card" data-category="{{ post.categories | first }}" data-tags="{{ post.tags | join: ',' }}" data-title="{{ post.title }}" data-date="{{ post.date | date: '%Y-%m-%d' }}">
        <div class="card-header">
          {% if post.image %}
          <div class="card-image">
            <img src="{{ post.image }}" alt="{{ post.title }}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\'image-placeholder\'><i class=\'fas fa-image\'></i></div>'">
            <div class="image-overlay">
              <i class="fas fa-eye"></i>
            </div>
          </div>
          {% else %}
          <div class="card-image placeholder" data-category="{{ post.categories | first }}">
            <div class="category-icon">
              {% if post.categories contains "科研" %}
                <i class="fas fa-microscope"></i>
              {% elsif post.categories contains "技术" %}
                <i class="fas fa-code"></i>
              {% elsif post.categories contains "杂谈" %}
                <i class="fas fa-coffee"></i>
              {% else %}
                <i class="fas fa-file-alt"></i>
              {% endif %}
            </div>
            <span class="placeholder-text">{{ post.categories | first | default: "文章" }}</span>
          </div>
          {% endif %}
          <div class="card-badge">
            {% if post.categories %}
            <span class="category-badge">{{ post.categories | first }}</span>
            {% endif %}
          </div>
        </div>
        
        <div class="card-content">
          <h3 class="card-title">
            <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
          </h3>
          
          <p class="card-summary">{{ post.excerpt | strip_html | truncate: 150 }}</p>
          
          <div class="card-meta">
            <div class="meta-item">
              <i class="far fa-calendar-alt"></i>
              <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%Y-%m-%d" }}</time>
            </div>
            {% if post.reading_time %}
            <div class="meta-item">
              <i class="far fa-clock"></i>
              <span>{{ post.reading_time }} min</span>
            </div>
            {% endif %}
          </div>
          
          {% if post.tags %}
          <div class="card-tags">
            {% for tag in post.tags %}
            <span class="tag" data-tag="{{ tag }}">{{ tag }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="card-footer">
          <a href="{{ post.url | relative_url }}" class="read-more-btn">
            <span>阅读全文</span>
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>
      </article>
      {% endfor %}
      
      <!-- Data-driven posts from _data/blog.yml -->
      {% for post in site.data.blog %}
      <article class="blog-post-card" data-category="{{ post.category }}" data-tags="{{ post.tags | join: ',' }}" data-title="{{ post.title }}" data-date="{{ post.date }}">
        <div class="card-header">
          {% if post.images and post.images.size > 0 %}
          <div class="card-image">
            <img src="{{ post.images[0] }}" alt="{{ post.title }}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\'image-placeholder\'><i class=\'fas fa-image\'></i></div>'">
            <div class="image-overlay">
              <i class="fas fa-eye"></i>
            </div>
          </div>
          {% elsif post.image %}
          <div class="card-image">
            <img src="{{ post.image }}" alt="{{ post.title }}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\'image-placeholder\'><i class=\'fas fa-image\'></i></div>'">
            <div class="image-overlay">
              <i class="fas fa-eye"></i>
            </div>
          </div>
          {% else %}
          <div class="card-image placeholder" data-category="{{ post.category }}">
            <div class="category-icon">
              {% if post.category == "科研" %}
                <i class="fas fa-microscope"></i>
              {% elsif post.category == "技术" %}
                <i class="fas fa-code"></i>
              {% elsif post.category == "杂谈" %}
                <i class="fas fa-coffee"></i>
              {% else %}
                <i class="fas fa-file-alt"></i>
              {% endif %}
            </div>
            <span class="placeholder-text">{{ post.category | default: "文章" }}</span>
          </div>
          {% endif %}
          <div class="card-badge">
            {% if post.category %}
            <span class="category-badge">{{ post.category }}</span>
            {% endif %}
            {% if post.images and post.images.size > 1 %}
            <span class="images-count-badge">
              <i class="fas fa-images"></i>
              {{ post.images.size }}
            </span>
            {% endif %}
          </div>
        </div>
        
        <div class="card-content">
          <h3 class="card-title">
            {% comment %}
            根据文件路径和categories生成Jekyll post URL
            格式：/category/subcategory/YYYY/MM/DD/title/
            {% endcomment %}
            {% assign post_file = post.file | replace: '_posts/', '' %}
            {% assign post_parts = post_file | split: '-' %}
            {% assign year = post_parts[0] %}
            {% assign month = post_parts[1] %}
            {% assign day = post_parts[2] %}
            {% assign filename_parts = post_file | split: '-' %}
            {% assign filename = '' %}
            {% for part in filename_parts offset: 3 %}
              {% if forloop.first %}
                {% assign filename = part %}
              {% else %}
                {% assign filename = filename | append: '-' | append: part %}
              {% endif %}
            {% endfor %}
            {% assign filename = filename | replace: '.md', '' %}
            {% assign post_url = '/' | append: post.category | append: '/' | append: post.subcategory | append: '/' | append: year | append: '/' | append: month | append: '/' | append: day | append: '/' | append: filename | append: '/' %}
            <a href="{{ post_url }}">{{ post.title }}</a>
          </h3>
          
          <p class="card-summary">{{ post.summary }}</p>
          
          <div class="card-meta">
            <div class="meta-item">
              <i class="far fa-calendar-alt"></i>
              <time datetime="{{ post.date }}">{{ post.date }}</time>
            </div>
            {% if post.reading_time %}
            <div class="meta-item">
              <i class="far fa-clock"></i>
              <span>{{ post.reading_time }} min</span>
            </div>
            {% endif %}
          </div>
          
          {% if post.tags %}
          <div class="card-tags">
            {% for tag in post.tags %}
            <span class="tag" data-tag="{{ tag }}">{{ tag }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="card-footer">
          {% comment %}
          使用同样的逻辑生成阅读全文链接
          {% endcomment %}
          {% assign post_file = post.file | replace: '_posts/', '' %}
          {% assign post_parts = post_file | split: '-' %}
          {% assign year = post_parts[0] %}
          {% assign month = post_parts[1] %}
          {% assign day = post_parts[2] %}
          {% assign filename_parts = post_file | split: '-' %}
          {% assign filename = '' %}
          {% for part in filename_parts offset: 3 %}
            {% if forloop.first %}
              {% assign filename = part %}
            {% else %}
              {% assign filename = filename | append: '-' | append: part %}
            {% endif %}
          {% endfor %}
          {% assign filename = filename | replace: '.md', '' %}
          {% assign post_url = '/' | append: post.category | append: '/' | append: post.subcategory | append: '/' | append: year | append: '/' | append: month | append: '/' | append: day | append: '/' | append: filename | append: '/' %}
          <a href="{{ post_url }}" class="read-more-btn">
            <span>阅读全文</span>
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>
      </article>
      {% endfor %}
    </div>
    
    <!-- No Results Message -->
    <div class="no-results" id="noResults" style="display: none;">
      <div class="no-results-icon">
        <i class="fas fa-search"></i>
      </div>
      <h3>未找到匹配的文章</h3>
      <p>尝试使用不同的关键词或标签进行搜索</p>
      <button class="btn-primary" onclick="clearAllFilters()">清除所有筛选条件</button>
    </div>
  </section>
</div>

<!-- Image Preview Modal -->
<div class="image-modal" id="imageModal" style="display: none;">
  <div class="modal-backdrop" onclick="closeImageModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title" id="modalTitle">图片预览</h3>
      <button class="modal-close" onclick="closeImageModal()" aria-label="关闭">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <img id="modalImage" src="" alt="" loading="lazy">
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeImageModal()">关闭</button>
    </div>
  </div>
</div>

<script src="assets/blog-image-enhancement.js"></script>
<script>
// Enhanced Blog Search and Filter Functionality
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('blogSearch');
  const searchClear = document.getElementById('searchClear');
  const categoryFilter = document.getElementById('categoryFilter');
  const sortFilter = document.getElementById('sortFilter');
  const blogCards = document.querySelectorAll('.blog-post-card');
  const blogGrid = document.getElementById('blogGrid');
  const tagCloud = document.getElementById('tagCloud');
  const resultsInfo = document.getElementById('resultsInfo');
  const visibleCount = document.getElementById('visibleCount');
  const noResults = document.getElementById('noResults');
  const viewButtons = document.querySelectorAll('.view-btn');
  const imageModal = document.getElementById('imageModal');
  const modalImage = document.getElementById('modalImage');
  const modalTitle = document.getElementById('modalTitle');
  
  // Initialize statistics
  initializeStats();
  
  // Generate category filter options
  generateCategoryFilter();
  
  // Generate tag cloud
  generateTagCloud();
  
  // Setup event listeners
  setupEventListeners();
  
  // Initialize view
  updateResultsCount();
  
  function initializeStats() {
    const categories = new Set();
    const tags = new Set();
    
    blogCards.forEach(card => {
      const category = card.dataset.category;
      if (category) categories.add(category);
      
      const cardTags = card.dataset.tags.split(',');
      cardTags.forEach(tag => {
        if (tag.trim()) tags.add(tag.trim());
      });
    });
    
    document.getElementById('totalCategories').textContent = categories.size;
    document.getElementById('totalTags').textContent = tags.size;
  }
  
  function generateCategoryFilter() {
    const categories = new Set();
    
    blogCards.forEach(card => {
      const category = card.dataset.category;
      if (category) categories.add(category);
    });
    
    categories.forEach(category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      categoryFilter.appendChild(option);
    });
  }
  
  function generateTagCloud() {
    const tagCounts = {};
    
    blogCards.forEach(card => {
      const tags = card.dataset.tags.split(',');
      tags.forEach(tag => {
        const trimmedTag = tag.trim();
        if (trimmedTag) {
          tagCounts[trimmedTag] = (tagCounts[trimmedTag] || 0) + 1;
        }
      });
    });
    
    // Sort tags by frequency
    const sortedTags = Object.entries(tagCounts)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 20); // Show top 20 tags
    
    sortedTags.forEach(([tag, count]) => {
      const tagElement = document.createElement('button');
      tagElement.className = 'tag-cloud-item';
      tagElement.textContent = tag;
      tagElement.title = `${count} 篇文章`;
      tagElement.onclick = () => filterByTag(tag);
      tagCloud.appendChild(tagElement);
    });
  }
  
  function setupEventListeners() {
    searchInput.addEventListener('input', handleSearch);
    searchClear.addEventListener('click', clearSearch);
    categoryFilter.addEventListener('change', filterPosts);
    sortFilter.addEventListener('change', sortPosts);
    
    viewButtons.forEach(btn => {
      btn.addEventListener('click', () => toggleView(btn.dataset.view));
    });
    
    // Tag click handlers
    document.addEventListener('click', function(e) {
      if (e.target.matches('.tag[data-tag]')) {
        filterByTag(e.target.dataset.tag);
      }
    });
    
    // Image preview handler
    document.addEventListener('click', function(e) {
      if (e.target.closest('.blog-post-card')) {
        const card = e.target.closest('.blog-post-card');
        const imageUrl = card.querySelector('img').src;
        const title = card.querySelector('.card-title').textContent;
        
        openImageModal(imageUrl, title);
      }
    });
  }
  
  function handleSearch() {
    const hasValue = searchInput.value.trim() !== '';
    searchClear.style.display = hasValue ? 'block' : 'none';
    filterPosts();
  }
  
  function clearSearch() {
    searchInput.value = '';
    searchClear.style.display = 'none';
    filterPosts();
  }
  
  function filterByTag(tag) {
    searchInput.value = tag;
    searchClear.style.display = 'block';
    filterPosts();
    
    // Scroll to results
    document.getElementById('resultsInfo').scrollIntoView({ 
      behavior: 'smooth', 
      block: 'start' 
    });
  }
  
  function filterPosts() {
    const query = searchInput.value.toLowerCase();
    const selectedCategory = categoryFilter.value;
    let visibleCards = 0;
    
    blogCards.forEach(card => {
      const title = card.dataset.title.toLowerCase();
      const summary = card.querySelector('.card-summary').textContent.toLowerCase();
      const tags = card.dataset.tags.toLowerCase();
      const category = card.dataset.category;
      
      const matchesSearch = !query || 
        title.includes(query) || 
        summary.includes(query) || 
        tags.includes(query);
      
      const matchesCategory = !selectedCategory || category === selectedCategory;
      
      const isVisible = matchesSearch && matchesCategory;
      card.style.display = isVisible ? 'block' : 'none';
      
      if (isVisible) visibleCards++;
    });
    
    updateResultsCount(visibleCards);
    noResults.style.display = visibleCards === 0 ? 'block' : 'none';
    blogGrid.style.display = visibleCards === 0 ? 'none' : 'grid';
  }
  
  function sortPosts() {
    const sortValue = sortFilter.value;
    const cardsArray = Array.from(blogCards);
    
    cardsArray.sort((a, b) => {
      switch (sortValue) {
        case 'date-desc':
          return new Date(b.dataset.date) - new Date(a.dataset.date);
        case 'date-asc':
          return new Date(a.dataset.date) - new Date(b.dataset.date);
        case 'title-asc':
          return a.dataset.title.localeCompare(b.dataset.title);
        case 'title-desc':
          return b.dataset.title.localeCompare(a.dataset.title);
        default:
          return 0;
      }
    });
    
    // Re-append sorted cards
    cardsArray.forEach(card => blogGrid.appendChild(card));
  }
  
  function toggleView(view) {
    viewButtons.forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-view="${view}"]`).classList.add('active');
    
    blogGrid.className = view === 'list' ? 'blog-list' : 'blog-grid';
  }
  
  function updateResultsCount(count = null) {
    if (count === null) {
      count = Array.from(blogCards).filter(card => 
        card.style.display !== 'none'
      ).length;
    }
    visibleCount.textContent = count;
  }
  
  // Global function for no results button
  window.clearAllFilters = function() {
    searchInput.value = '';
    categoryFilter.value = '';
    sortFilter.value = 'date-desc';
    searchClear.style.display = 'none';
    filterPosts();
    sortPosts();
  };
  
  // Image preview functionality
  window.openImageModal = function(imageSrc, imageAlt, articleTitle) {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    
    modalImage.src = imageSrc;
    modalImage.alt = imageAlt;
    modalTitle.textContent = articleTitle || '图片预览';
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    // Add keyboard support
    document.addEventListener('keydown', handleModalKeydown);
  };
  
  window.closeImageModal = function() {
    const modal = document.getElementById('imageModal');
    modal.style.display = 'none';
    document.body.style.overflow = '';
    
    // Remove keyboard listener
    document.removeEventListener('keydown', handleModalKeydown);
  };
  
  function handleModalKeydown(e) {
    if (e.key === 'Escape') {
      closeImageModal();
    }
  }
  
  // Add click handlers for image overlays
  document.addEventListener('click', function(e) {
    if (e.target.closest('.image-overlay')) {
      e.preventDefault();
      const card = e.target.closest('.blog-post-card');
      const img = card.querySelector('.card-image img');
      const title = card.querySelector('.card-title a').textContent;
      
      if (img && img.src) {
        openImageModal(img.src, img.alt, title);
      }
    }
  });
  
  // Enhanced image loading with error handling
  function setupImageLazyLoading() {
    const images = document.querySelectorAll('.card-image img');
    
    images.forEach(img => {
      img.classList.add('loading');
      
      img.addEventListener('load', function() {
        this.classList.remove('loading');
        this.classList.add('loaded');
      });
      
      img.addEventListener('error', function() {
        this.classList.add('error');
        console.warn('Failed to load image:', this.src);
        
        // Create fallback element
        const fallback = document.createElement('div');
        fallback.className = 'image-fallback';
        fallback.innerHTML = `
          <div class="category-icon">
            <i class="fas fa-image"></i>
          </div>
          <span class="placeholder-text">图片加载失败</span>
        `;
        
        this.parentElement.appendChild(fallback);
      });
    });
  }
  
  // Image gallery functionality for multiple images
  function setupImageGallery() {
    document.addEventListener('click', function(e) {
      if (e.target.matches('.images-count-badge') || e.target.closest('.images-count-badge')) {
        e.preventDefault();
        e.stopPropagation();
        
        const card = e.target.closest('.blog-post-card');
        const title = card.querySelector('.card-title a').textContent;
        
        // Get all images from the post data
        const cardElement = card;
        const imagesData = getPostImages(cardElement);
        
        if (imagesData && imagesData.length > 1) {
          openImageGallery(imagesData, title);
        }
      }
    });
  }
  
  function getPostImages(cardElement) {
    // This would need to be populated from the Jekyll data
    // For now, we'll simulate it
    const postTitle = cardElement.dataset.title;
    
    // You could extend this to include multiple images per post
    const mainImage = cardElement.querySelector('.card-image img');
    if (mainImage && mainImage.src) {
      return [{ src: mainImage.src, alt: mainImage.alt }];
    }
    
    return [];
  }
  
  function openImageGallery(images, title) {
    // For now, just open the first image
    if (images.length > 0) {
      openImageModal(images[0].src, images[0].alt, title);
    }
  }
  
  // Initialize enhanced features
  setupImageLazyLoading();
  setupImageGallery();
});
</script>

<!-- Blog Image Enhancement Script -->
<script src="assets/blog-image-enhancer.js"></script>

<!-- 阅读进度条脚本 -->
<script src="{{ '/assets/blog-reading-progress.js' | relative_url }}"></script>

{% endunless %}